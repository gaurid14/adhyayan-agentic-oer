{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard | Adhyayan</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'accounts/sidebar.css' %}">

    <style>
        :root {
          --bg-page: #FFFFFF;
          --bg-card: #F7F8FA;
          --border-soft: #E6E8EC;

          --text-primary: #0F172A;   /* slate-900 */
          --text-secondary: #475569; /* slate-600 */

          --brand: #0F766E;          /* muted enterprise teal */
          --brand-soft: #E6F4F1;
          --brand-hover: #115E59;
        }

        /* =====================
           RESET & BASE
        ===================== */
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI',sans-serif; }
        body { background:#FFFFFF; color:#333; display:flex; min-height:100vh; }
        ul { list-style:none; }

        /* =====================
           LAYOUT
        ===================== */
        .dashboard-layout { display:flex; width:100%; }

        /* =====================
           MAIN CONTENT
        ===================== */
        .main-content {
            flex-grow:1;
            margin-left:260px;
            padding:30px 40px;
        }

        /* TOP BAR */
        .topbar {
            display:flex;
            justify-content:space-between;
            align-items:center;
            background:#fff;
            padding:12px 20px;
            border-radius:10px;
            border: 1px solid #E5E7EB;
            box-shadow:none;
            margin-bottom:25px;
        }

        .topbar-left { display:flex; align-items:center; gap:15px; }
        .role-badge {
            background:#e6f8f7;
            color:#1EAE98;
            font-size:12px;
            padding:4px 10px;
            border-radius:20px;
            font-weight:600;
        }

        .topbar-right { display:flex; align-items:center; gap:20px; }
        .notification-icon { font-size:18px; cursor:pointer; }
        .user-chip {
            background:#F9FAFB;
            border: 1px solid #E5E7EB;
            color: #111827;
            padding:6px 12px;
            border-radius:20px;
            font-size:14px;
        }

        /* PAGE HEADER */
        .main-header h1 { font-size:24px; margin-bottom:20px; }

        /* =====================
           KPI CARDS
        ===================== */
        .kpi-grid {
            display:grid;
            grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
            gap:20px;
            margin-bottom:30px;
        }

        .kpi-card {
            background:#fff;
            padding:20px;
            border-radius:12px;
            border: 1px solid #E5E7EB;
            box-shadow:0 1px 1px rgba(0,0,0,0.02);
        }

        .kpi-card h3 {
          color: var(--text-primary);
          font-weight: 600;
        }

        .org-name {
          color: var(--text-primary);
        }


        /* =====================
           CONTENT SECTIONS
        ===================== */
        .content-section { display:none; }
        .content-section.active { display:block; animation:fadeIn 0.4s ease; }

        /* =====================
           CARDS
        ===================== */
        .card {
            background:#fff;
            border-radius:12px;
            padding:25px;
            border: 1px solid #E5E7EB;
            box-shadow:0 1px 1px rgba(0,0,0,0.02);
            margin-bottom:30px;
        }
        .card-title {
            font-size:20px;
            color: #111827;
            font-weight: 600;
            margin-bottom:20px;
            border-bottom:1px solid #eee;
            padding-bottom:10px;
        }
        .card {
          border: 1px solid #E6E8EC;
        }

        body {
          color: #1F2937;
        }

        p, td {
          color: #374151;
        }

        /* =====================
           COURSE GRID
        ===================== */
        .course-grid {
            display:grid;
            grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
            gap:20px;
        }

        .course-card {
            background: #FFFFFF;
            padding: 16px 18px;
            border-radius: 8px;
            border: 1px solid #E5E7EB;
            box-shadow: none;
        }

        .course-card:hover {
            border-color: #D1FAE5;
            background: #FAFAFA;
        }


        .course-card h4 { margin-bottom:6px; }
        .course-card p { font-size:13px; color:#777; margin-bottom:15px; }

        .status {
            position:absolute;
            top:15px;
            right:15px;
            font-size:11px;
            padding:4px 10px;
            border-radius:12px;
            font-weight:600;
        }
        .status.approved {
          background: var(--brand-soft);
          color: var(--brand);
        }

        .card,
        .topbar,
        .course-card {
        border: 1px solid #E5E7EB;
          box-shadow: 0 1px 1px rgba(0,0,0,0.02),
                      0 1px 2px rgba(0,0,0,0.02);
        }



        .primary-btn {
            background:#1EAE98;
            color:#fff;
            border:none;
            padding:8px 14px;
            border-radius:6px;
            cursor:pointer;
        }
        .primary-btn:hover { background:#178D79; }

        /* =====================
           CONTRIBUTIONS
        ===================== */
        .content-list li {
            background:#f8f9fa;
            padding:15px;
            border-radius:8px;
            margin-bottom:10px;
            border-left:4px solid #1EAE98;
        }

        .badge {
            padding:4px 10px;
            border-radius:12px;
            font-size:12px;
            font-weight:600;
        }
        .badge.pending { background:#fff3cd; color:#856404; }
        .badge.evaluated { background:#d4edda; color:#155724; }

        /* =====================
           MODAL
        ===================== */
        .modal-overlay {
            position:fixed; inset:0;
            background:rgba(0,0,0,0.6);
            display:flex;
            align-items:center;
            justify-content:center;
            opacity:0; visibility:hidden;
            transition:0.3s;
            z-index:1000;
        }
        body.modal-open .modal-overlay { opacity:1; visibility:visible; }

        .modal {
            background:#fff;
            width:90%;
            max-width:500px;
            border-radius:12px;
            padding:20px;
        }

        /* =====================
           ANIMATIONS
        ===================== */
        @keyframes fadeIn {
            from { opacity:0; transform:translateY(10px); }
            to { opacity:1; transform:none; }
        }

        /* =====================
           SLIDE-OUT DRAWER
        ===================== */
        .chapters-drawer {
            position: fixed;
            top: 0;
            right: 0;
            width: 380px;
            height: 100%;
            background: #ffffff;
            border: 1px solid #E5E7EB;
            box-shadow: 0 1px 1px rgba(0,0,0,0.02);
            padding: 25px;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 1100;
            display: flex;
            flex-direction: column;
        }

        .drawer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .drawer-header h3 {
            font-size: 20px;
            color: #333;
        }

        #close-drawer-btn {
            font-size: 28px;
            border: none;
            background: none;
            cursor: pointer;
            color: #888;
        }

        #drawer-chapters-list li {
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 8px;
            background: #f8f9fa;
        }

        #drawer-chapters-list li a {
            color: #333;
            font-weight: 500;
        }

        #drawer-chapters-list li:hover {
            background: #e6f8f7;
        }

        #drawer-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.4);
            opacity: 0;
            visibility: hidden;
            transition: 0.3s;
            z-index: 1000;
        }

        body.drawer-open .chapters-drawer {
            transform: translateX(0);
        }

        body.drawer-open #drawer-overlay {
            opacity: 1;
            visibility: visible;
        }

        .notification-wrapper {
            position: relative;
        }

        .notification-btn {
            background: none;
            border: none;
            cursor: pointer;
            position: relative;
        }

        .notif-badge {
            position: absolute;
            top: -4px;
            right: -6px;
            background: #e53935;
            color: #fff;
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 12px;
        }

        .notification-dropdown {
            display: none;
            position: absolute;
            right: 0;
            top: 42px;
            width: 320px;
            background: #fff;
            border-radius: 12px;
            border: 1px solid #E5E7EB;
            box-shadow: 0 1px 1px rgba(0,0,0,0.02);
            z-index: 100;
        }

        .notification-dropdown.show {
            display: block;
        }

        .notif-header {
            padding: 14px;
            font-weight: 700;
            border-bottom: 1px solid #eee;
        }

        .notif-item {
            padding: 12px 14px;
            font-size: 14px;
            border-bottom: 1px solid #f2f2f2;
        }

        .notif-item.unread {
            background: #f0faf8;
            font-weight: 600;
        }

        #drawer-chapters-list li {
            padding: 12px 14px;
            border-radius: 8px;
            margin-bottom: 8px;
            background: #F8FAFC;
            transition: background 0.2s ease, transform 0.15s ease;
        }

        #drawer-chapters-list li:hover {
            background: #E6F4F1;
            transform: translateX(4px);
        }

        #drawer-chapters-list li a {
            text-decoration: none;
            color: #0F172A;
            display: block;
            width: 100%;
        }

        #drawer-chapters-list li::after {
            float: right;
            color: #94A3B8;
        }

        .topbar-right {
            margin-left: auto;
        }

        /* ===== Flat section style (enterprise) ===== */
        .flat-section {
            margin-top: 32px;
        }

        .section-heading {
            font-size: 18px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 16px;
        }


        /* ===== De-cardify inner content ===== */

        /* KPI cards â€“ keep accent */
        .kpi-card {
            box-shadow: none;
            border: 1px solid #E5E7EB;
            border-top: 3px solid var(--brand);
            border-radius: 10px;
        }

        /* Course cards â€“ neutral */
        .course-card {
            border: 1px solid #E5E7EB;
            border-radius: 8px;
            box-shadow: none;
            background: #FFFFFF;
        }

        /* Generic cards â€“ flat */
        .card {
            border: 1px solid #E5E7EB;
            border-radius: 10px;
            box-shadow: none;
        }


        /* Remove rounded stacking feel */
        .card,
        .course-card {
            border-radius: 10px;
        }

        .flat-section {
            margin-top: 36px;
        }

        .section-heading {
            margin-bottom: 20px;
        }

        .section-subtext {
            font-size: 13px;
            font-weight: 500;
            color: #6B7280;
            margin-left: 8px;
        }

        .page-context {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
        }

        .dashboard-content {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .dashboard-content:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(0,0,0,0.08);
        }


    </style>
</head>

<body>

<div class="dashboard-layout">
    {% include "student/sidebar.html" %}
    <!-- MAIN -->
    <main class="main-content">

        <!-- TOP BAR -->
        <div class="topbar">
            <div class="topbar-left">
                <span class="page-context">Student Dashboard</span>
            </div>

            <div class="topbar-right">

                <!-- ðŸ”” Notification Component -->
                <div class="notification-wrapper">
                    <button class="notification-btn" onclick="toggleNotifications()">
                        <i class="fas fa-bell notification-icon"></i>

                        {% if unread_count > 0 %}
                        <span class="notif-badge">{{ unread_count }}</span>
                        {% endif %}
                    </button>

                    <div class="notification-dropdown" id="notifDropdown">
                        <div class="notif-header">Notifications</div>

                        {% for notif in notifications %}
                        <div class="notif-item {% if not notif.is_read %}unread{% endif %}">
                            <strong>{{ notif.title }}</strong>
                            <p>{{ notif.message }}</p>
                        </div>
                        {% empty %}
                        <div class="notif-item">No notifications</div>
                        {% endfor %}
                    </div>
                </div>

                <!-- ðŸ‘¤ User -->
                <span class="user-chip">{{ user.first_name }} {{ user.last_name }}</span>
            </div>
        </div>


        <div id="content-area">

            <!-- DASHBOARD -->
            <section id="dashboard-content" class="content-section active">

                <div class="kpi-grid">
                    <div class="kpi-card">
                        <h3>{{ enrolled_courses|length }}</h3>
                        <p>Enrolled Subjects</p>
                    </div>
                    <div class="kpi-card">
                        <h3>{{ completed_courses|length }}</h3>
                        <p>Completed Subjects</p>
                    </div>
                </div>

                {% comment %} <section class="flat-section">
                <h2 class="section-heading">Available Courses</h2>
                <div class="course-grid">
                    {% for course in courses %}
                    <div class="course-card">
                        <span class="status approved">Active</span>
                        <h4>{{ course.course_name }}</h4>
                        <p>Subject Code: {{ course.course_code }}</p>
                        <button class="primary-btn view-chapters-btn"
                                data-course-id="{{ course.id }}"
                                data-course-name="{{ course.course_name }}">
                            View Chapters
                        </button>
                    </div>
                    {% empty %}
                    <p>No courses found.</p>
                    {% endfor %}
                </div>
            </section> {% endcomment %}



                <!-- STUDENT SUBJECTS -->
                <section class="flat-section">
                    <h2 class="section-heading">Information Technology â€“ Semester 5 Subjects</h2>

                    <div class="course-grid">
                        {% for course in all_courses %}
                        <div class="course-card">
                            <h4>{{ course.course_name }}</h4>
                            <p class="subject-code">Subject Code: {{ course.course_code|default:"--" }}</p>
                            <p class="subject-meta">Third Year Â· Semester {{ course.semester|default:"5" }}</p>

                            {% if course.id in enrolled_course_ids %}
                            <a href="{% url 'student_course_chapters' course.id %}" class="primary-btn" style="background: #0F766E; text-decoration: none; display: inline-block;">
                                View Chapters
                            </a>
                            {% else %}
                            <form action="{% url 'enroll_course' %}" method="POST" style="display: inline;">
                                {% csrf_token %}
                                <input type="hidden" name="course_id" value="{{ course.id }}">
                                <button type="submit" class="primary-btn" style="background: #1EAE98; border: none;">
                                    Enroll Now
                                </button>
                            </form>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                </section>

            </section>

        </div>
    </main>
</div>

<!-- CHAPTERS DRAWER -->
<div id="chapters-drawer" class="chapters-drawer">
    <div class="drawer-header">
        <h3 id="drawer-course-title">Chapters</h3>
        <button id="close-drawer-btn">&times;</button>
    </div>
    <ul id="drawer-chapters-list"></ul>
</div>

<div id="drawer-overlay"></div>

<script id="chapters-data" type="application/json">
    {{ chapters_json|safe }}
</script>

<script>
    function toggleNotifications() {
        document.getElementById("notifDropdown")
            .classList.toggle("show");
    }
</script>

<script>

    document.addEventListener('DOMContentLoaded', function () {

        const chaptersData = JSON.parse(
            document.getElementById('chapters-data')?.textContent || '{}'
        );

        const drawer = document.getElementById('chapters-drawer');
        const drawerTitle = document.getElementById('drawer-course-title');
        const drawerList = document.getElementById('drawer-chapters-list');
        const closeBtn = document.getElementById('close-drawer-btn');
        const overlay = document.getElementById('drawer-overlay');
        const body = document.body;

        function openDrawer(courseId, courseName) {
            drawerTitle.textContent = `Chapters for ${courseName}`;
            drawerList.innerHTML = '';

            const chapters = chaptersData[courseId] || [];

            if (chapters.length > 0) {
                // Sort chapters by number just in case
                chapters.sort((a, b) => a.chapter_number - b.chapter_number);

                chapters.forEach(chap => {
                    const li = document.createElement('li');
                    li.style.display = "flex";
                    li.style.justifyContent = "space-between";
                    li.style.alignItems = "center";

                    // Chapter Label
                    const span = document.createElement('span');
                    span.textContent = `Chapter ${chap.chapter_number}: ${chap.chapter_name}`;
                    span.style.fontWeight = "500";

                    // Drive Link Button
                    if (chap.drive_url) {
                        const a = document.createElement('a');
                        a.href = chap.drive_url;
                        a.target = "_blank";
                        a.innerHTML = '<i class="fab fa-google-drive"></i> View';
                        a.className = "primary-btn"; // Use your existing button style
                        a.style.textDecoration = "none";
                        a.style.fontSize = "12px";
                        a.style.padding = "5px 10px";

                        li.appendChild(span);
                        li.appendChild(a);
                    } else {
                        li.appendChild(span);
                        const small = document.createElement('small');
                        small.textContent = "Pending";
                        small.style.color = "#94A3B8";
                        li.appendChild(small);
                    }

                    drawerList.appendChild(li);
                });
            } else {
                drawerList.innerHTML = '<li style="color: #64748B;">This course has not reached the release threshold yet.</li>';
            }

            body.classList.add('drawer-open');
        }

        function closeDrawer() {
            body.classList.remove('drawer-open');
        }

        // ENTERPRISE EVENT DELEGATION
        document.body.addEventListener('click', function (e) {
            const btn = e.target.closest('.view-chapters-btn');
            if (!btn) return;

            openDrawer(btn.dataset.courseId, btn.dataset.courseName);
        });

        closeBtn.addEventListener('click', closeDrawer);
        overlay.addEventListener('click', closeDrawer);

    });
</script>


</body>
</html>
